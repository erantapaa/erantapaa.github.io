<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- arch-tag: GZip file support in Haskell
Copyright (c) 2004-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">{- |
   Module     : System.FileArchive.GZip
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

GZip file decompression

Copyright (c) 2004 John Goerzen, jgoerzen\@complete.org

The GZip format is described in RFC1952.
-}</span><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FileArchive</span><span class="hs-operator">.</span><span class="hs-identifier">GZip</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-25"></a><span>                                  </span><span class="hs-comment">-- * GZip Files</span><span>
</span><a name="line-26"></a><span>                                  </span><span class="hs-comment">-- $gzipfiles</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>                                  </span><span class="hs-comment">-- * Types</span><span>
</span><a name="line-29"></a><span>                                  </span><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier hs-type">Header</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="System.FileArchive.GZip.html#Section" xdef=""><span class="hs-identifier hs-type">Section</span></a><span class="hs-special">,</span><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>                                  </span><a href="System.FileArchive.GZip.html#Footer" xdef=""><span class="hs-identifier hs-type">Footer</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>                                  </span><span class="hs-comment">-- * Whole-File Processing</span><span>
</span><a name="line-32"></a><span>                                  </span><a href="System.FileArchive.GZip.html#decompress" xdef=""><span class="hs-identifier hs-var">decompress</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>                                  </span><a href="System.FileArchive.GZip.html#hDecompress" xdef=""><span class="hs-identifier hs-var">hDecompress</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>                                  </span><a href="System.FileArchive.GZip.html#read_sections" xdef=""><span class="hs-identifier hs-var">read_sections</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                                  </span><span class="hs-comment">-- * Section Processing</span><span>
</span><a name="line-36"></a><span>                                  </span><a href="System.FileArchive.GZip.html#read_header" xdef=""><span class="hs-identifier hs-var">read_header</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>                                  </span><a href="System.FileArchive.GZip.html#read_section" xdef=""><span class="hs-identifier hs-var">read_section</span></a><span>
</span><a name="line-38"></a><span>                                 </span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Compression.Inflate.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Compression</span><span class="hs-operator">.</span><span class="hs-identifier">Inflate</span></a><span> </span><span class="hs-special">(</span><a href="Data.Compression.Inflate.html#inflate_string_remainder" xdef="imported from Data.Compression.Inflate"><span class="hs-identifier hs-var">inflate_string_remainder</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Hash.CRC32.GZip.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Hash</span><span class="hs-operator">.</span><span class="hs-identifier">CRC32</span><span class="hs-operator">.</span><span class="hs-identifier">GZip</span></a><span> </span><span class="hs-special">(</span><a href="Data.Hash.CRC32.GZip.html#update_crc" xdef="imported from Data.Hash.CRC32.GZip"><span class="hs-identifier hs-var">update_crc</span></a><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a xdef="imported from Data.Bits" xref="base:Data.Bits..&amp;."><span class="hs-operator hs-var">.&amp;.</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span> </span><span class="hs-comment">-- (Error(), strMsg, throwError)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span> </span><span class="hs-special">(</span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span> </span><span class="hs-special">(</span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Bits.Utils.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span> </span><span class="hs-special">(</span><a href="Data.Bits.Utils.html#fromBytes" xdef="imported from Data.Bits.Utils"><span class="hs-identifier hs-var">fromBytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Text.hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Text.hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Types.Handle"><span class="hs-identifier hs-type">Handle</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">data</span><span> </span><a name="GZipError"><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier">GZipError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CRCError"><a href="System.FileArchive.GZip.html#CRCError" xdef=""><span class="hs-identifier">CRCError</span></a></a><span>               </span><span class="hs-comment">-- ^ CRC-32 check failed</span><span>
</span><a name="line-51"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="NotGZIPFile"><a href="System.FileArchive.GZip.html#NotGZIPFile" xdef=""><span class="hs-identifier">NotGZIPFile</span></a></a><span>            </span><span class="hs-comment">-- ^ Couldn't find a GZip header</span><span>
</span><a name="line-52"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="UnknownMethod"><a href="System.FileArchive.GZip.html#UnknownMethod" xdef=""><span class="hs-identifier">UnknownMethod</span></a></a><span>          </span><span class="hs-comment">-- ^ Compressed with something other than method 8 (deflate)</span><span>
</span><a name="line-53"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="UnknownError"><a href="System.FileArchive.GZip.html#UnknownError" xdef=""><span class="hs-identifier">UnknownError</span></a></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span>    </span><span class="hs-comment">-- ^ Other problem arose</span><span>
</span><a name="line-54"></a><span>               </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes.Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Show.Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">instance</span><span> </span><a xdef="imported from Control.Monad.Error" xref="trans_3eG64VdP2vzGjP6wJiCp5X:Control.Monad.Trans.Error.Error"><span class="hs-identifier hs-type">Error</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>    </span><a name="local-1912610560"><a xdef="imported from Control.Monad.Error" xref="trans_3eG64VdP2vzGjP6wJiCp5X:Control.Monad.Trans.Error.noMsg"><span class="hs-identifier">noMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#UnknownError" xdef=""><span class="hs-identifier hs-var">UnknownError</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-58"></a><span>    </span><a name="local-1912610561"><a xdef="imported from Control.Monad.Error" xref="trans_3eG64VdP2vzGjP6wJiCp5X:Control.Monad.Trans.Error.strMsg"><span class="hs-identifier">strMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#UnknownError" xdef=""><span class="hs-identifier hs-var">UnknownError</span></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">-- | First two bytes of file</span><span>
</span><a name="line-61"></a><span class="hs-identifier">magic</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-62"></a><a name="magic"><a href="System.FileArchive.GZip.html#magic" xdef=""><span class="hs-identifier">magic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\x1f\x8b&quot;</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | Flags</span><span>
</span><a name="line-65"></a><span class="hs-identifier">fFHCRC</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fFEXTRA</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fFNAME</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fFCOMMENT</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Int"><span class="hs-identifier hs-type">Int</span></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- fFTEXT = 1 :: Int</span><span>
</span><a name="line-67"></a><a name="fFHCRC"><a href="System.FileArchive.GZip.html#fFHCRC" xdef=""><span class="hs-identifier">fFHCRC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-68"></a><a name="fFEXTRA"><a href="System.FileArchive.GZip.html#fFEXTRA" xdef=""><span class="hs-identifier">fFEXTRA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-69"></a><a name="fFNAME"><a href="System.FileArchive.GZip.html#fFNAME" xdef=""><span class="hs-identifier">fFNAME</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-70"></a><a name="fFCOMMENT"><a href="System.FileArchive.GZip.html#fFCOMMENT" xdef=""><span class="hs-identifier">fFCOMMENT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">{- | The data structure representing the GZip header.  This occurs
at the beginning of each 'Section' on disk. -}</span><span>
</span><a name="line-74"></a><span class="hs-keyword">data</span><span> </span><a name="Header"><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier">Header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Header"><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier">Header</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-75"></a><span>                      </span><a name="method"><a href="System.FileArchive.GZip.html#method" xdef=""><span class="hs-identifier">method</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ Compression method.  Only 8 is defined at present.</span><span>
</span><a name="line-76"></a><span>                      </span><a name="flags"><a href="System.FileArchive.GZip.html#flags" xdef=""><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>                      </span><a name="extra"><a href="System.FileArchive.GZip.html#extra" xdef=""><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>                      </span><a name="filename"><a href="System.FileArchive.GZip.html#filename" xdef=""><span class="hs-identifier">filename</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>                      </span><a name="comment"><a href="System.FileArchive.GZip.html#comment" xdef=""><span class="hs-identifier">comment</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>                      </span><a name="mtime"><a href="System.FileArchive.GZip.html#mtime" xdef=""><span class="hs-identifier">mtime</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Modification time of the original file</span><span>
</span><a name="line-81"></a><span>                      </span><a name="xfl"><a href="System.FileArchive.GZip.html#xfl" xdef=""><span class="hs-identifier">xfl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Extra flags</span><span>
</span><a name="line-82"></a><span>                      </span><a name="os"><a href="System.FileArchive.GZip.html#os" xdef=""><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Int"><span class="hs-identifier hs-type">Int</span></a><span>         </span><span class="hs-comment">-- ^ Creating operating system</span><span>
</span><a name="line-83"></a><span>                     </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes.Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Show.Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">{- | Stored on-disk at the end of each section. -}</span><span>
</span><a name="line-86"></a><span class="hs-keyword">data</span><span> </span><a name="Footer"><a href="System.FileArchive.GZip.html#Footer" xdef=""><span class="hs-identifier">Footer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Footer"><a href="System.FileArchive.GZip.html#Footer" xdef=""><span class="hs-identifier">Footer</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-87"></a><span>                      </span><a name="size"><a href="System.FileArchive.GZip.html#size" xdef=""><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ The size of the original, decompressed data</span><span>
</span><a name="line-88"></a><span>                      </span><a name="crc32"><a href="System.FileArchive.GZip.html#crc32" xdef=""><span class="hs-identifier">crc32</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ The stored GZip CRC-32 of the original, decompressed data</span><span>
</span><a name="line-89"></a><span>                      </span><a name="crc32valid"><a href="System.FileArchive.GZip.html#crc32valid" xdef=""><span class="hs-identifier">crc32valid</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Bool"><span class="hs-identifier hs-type">Bool</span></a><span> </span><span class="hs-comment">-- ^ Whether or not the stored CRC-32 matches the calculated CRC-32 of the data</span><span>
</span><a name="line-90"></a><span>                     </span><span class="hs-special">}</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">{- | A section represents a compressed component in a GZip file.
Every GZip file has at least one. -}</span><span>
</span><a name="line-94"></a><span class="hs-keyword">type</span><span> </span><a name="Section"><a href="System.FileArchive.GZip.html#Section" xdef=""><span class="hs-identifier">Section</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier hs-type">Header</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a href="System.FileArchive.GZip.html#Footer" xdef=""><span class="hs-identifier hs-type">Footer</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-identifier">split1</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Char"><span class="hs-identifier hs-type">Char</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="split1"><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier">split1</span></a></a><span> </span><a name="local-1627431723"><a href="#local-1627431723"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.List.head"><span class="hs-identifier hs-var">head</span></a><span> </span><a href="#local-1627431723"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.tail"><span class="hs-identifier hs-var">tail</span></a><span> </span><a href="#local-1627431723"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">{- | Read a GZip file, decompressing all sections found.

Writes the decompressed data stream to the given output handle.

Returns Nothing if the action was successful, or Just GZipError if there
was a problem.  If there was a problem, the data written to the output
handle should be discarded.
-}</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">hDecompress</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Types.Handle"><span class="hs-identifier hs-type">Handle</span></a><span>                   </span><span class="hs-comment">-- ^ Input handle</span><span>
</span><a name="line-109"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Types.Handle"><span class="hs-identifier hs-type">Handle</span></a><span>                   </span><span class="hs-comment">-- ^ Output handle</span><span>
</span><a name="line-110"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><a name="hDecompress"><a href="System.FileArchive.GZip.html#hDecompress" xdef=""><span class="hs-identifier">hDecompress</span></a></a><span> </span><a name="local-1627431724"><a href="#local-1627431724"><span class="hs-identifier">infd</span></a></a><span> </span><a name="local-1627431725"><a href="#local-1627431725"><span class="hs-identifier">outfd</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-1627431824"><a href="#local-1627431824"><span class="hs-identifier">inc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Text.hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span> </span><a href="#local-1627431724"><span class="hs-identifier hs-var">infd</span></a><span>
</span><a name="line-113"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431825"><a href="#local-1627431825"><span class="hs-identifier">outstr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431826"><a href="#local-1627431826"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#decompress" xdef=""><span class="hs-identifier hs-var">decompress</span></a><span> </span><a href="#local-1627431824"><span class="hs-identifier hs-var">inc</span></a><span>
</span><a name="line-114"></a><span>       </span><a xdef="imported from System.IO" xref="base:GHC.IO.Handle.Text.hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span> </span><a href="#local-1627431725"><span class="hs-identifier hs-var">outfd</span></a><span> </span><a href="#local-1627431825"><span class="hs-identifier hs-var">outstr</span></a><span>
</span><a name="line-115"></a><span>       </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627431826"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">{- | Read a GZip file, decompressing all sections that are found.

Returns a decompresed data stream and Nothing, or an unreliable string
and Just (error).  If you get anything other than Nothing, the String
returned should be discarded.
-}</span><span>
</span><a name="line-123"></a><span class="hs-identifier">decompress</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span class="hs-comment">{-
decompress s =
    do x &lt;- read_header s
       let rem = snd x
       return $ inflate_string rem
-}</span><span>
</span><a name="line-130"></a><a name="decompress"><a href="System.FileArchive.GZip.html#decompress" xdef=""><span class="hs-identifier">decompress</span></a></a><span> </span><a name="local-1627431827"><a href="#local-1627431827"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">procs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="System.FileArchive.GZip.html#Section" xdef=""><span class="hs-identifier hs-type">Section</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.Bool"><span class="hs-identifier hs-type">Bool</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>        </span><a name="local-1627431828"><a href="#local-1627431828"><span class="hs-identifier">procs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Types.True"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-identifier">procs</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627431829"><a href="#local-1627431829"><span class="hs-identifier">content</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431830"><a href="#local-1627431830"><span class="hs-identifier">foot</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-1627431831"><a href="#local-1627431831"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431832"><a href="#local-1627431832"><span class="hs-identifier">nexth</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431833"><a href="#local-1627431833"><span class="hs-identifier">nextb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431828"><span class="hs-identifier hs-var">procs</span></a><span> </span><a href="#local-1627431831"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-135"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627431829"><span class="hs-identifier hs-var">content</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.++"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1627431832"><span class="hs-identifier hs-var">nexth</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="System.FileArchive.GZip.html#crc32valid" xdef=""><span class="hs-identifier hs-var">crc32valid</span></a><span> </span><a href="#local-1627431830"><span class="hs-identifier hs-var">foot</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes.&amp;&amp;"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="#local-1627431833"><span class="hs-identifier hs-var">nextb</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="System.FileArchive.GZip.html#read_sections" xdef=""><span class="hs-identifier hs-var">read_sections</span></a><span> </span><a href="#local-1627431827"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-137"></a><span>           </span><a xdef="imported from Prelude" xref="base:Data.Either.Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-1627431834"><a href="#local-1627431834"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627431834"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>           </span><a xdef="imported from Prelude" xref="base:Data.Either.Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a name="local-1627431835"><a href="#local-1627431835"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431836"><a href="#local-1627431836"><span class="hs-identifier">decomp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431837"><a href="#local-1627431837"><span class="hs-identifier">iscrcok</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431828"><span class="hs-identifier hs-var">procs</span></a><span> </span><a href="#local-1627431835"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-139"></a><span>                          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-1627431836"><span class="hs-identifier hs-var">decomp</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627431837"><span class="hs-identifier hs-var">iscrcok</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="System.FileArchive.GZip.html#CRCError" xdef=""><span class="hs-identifier hs-var">CRCError</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">{-
decompress s = do x &lt;- read_sections s
                  return $ concatMap (\(_, x, _) -&gt; x) x
-}</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | Read all sections.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">read_sections</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Either.Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span> </span><span class="hs-special">[</span><a href="System.FileArchive.GZip.html#Section" xdef=""><span class="hs-identifier hs-type">Section</span></a><span class="hs-special">]</span><span>
</span><a name="line-148"></a><a name="read_sections"><a href="System.FileArchive.GZip.html#read_sections" xdef=""><span class="hs-identifier">read_sections</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Either.Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-149"></a><span class="hs-identifier">read_sections</span><span> </span><a name="local-1627431838"><a href="#local-1627431838"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-1627431839"><a href="#local-1627431839"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.FileArchive.GZip.html#read_section" xdef=""><span class="hs-identifier hs-var">read_section</span></a><span> </span><a href="#local-1627431838"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-151"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627431839"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-152"></a><span>           </span><span class="hs-special">(</span><a name="local-1627431840"><a href="#local-1627431840"><span class="hs-identifier">sect</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431841"><a href="#local-1627431841"><span class="hs-identifier">remain</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-153"></a><span>               </span><span class="hs-keyword">do</span><span> </span><a name="local-1627431842"><a href="#local-1627431842"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.FileArchive.GZip.html#read_sections" xdef=""><span class="hs-identifier hs-var">read_sections</span></a><span> </span><a href="#local-1627431841"><span class="hs-identifier hs-var">remain</span></a><span>
</span><a name="line-154"></a><span>                  </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.$"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1627431840"><span class="hs-identifier hs-var">sect</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627431842"><span class="hs-identifier hs-var">next</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">parseword</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span>
</span><a name="line-157"></a><a name="parseword"><a href="System.FileArchive.GZip.html#parseword" xdef=""><span class="hs-identifier">parseword</span></a></a><span> </span><a name="local-1627431843"><a href="#local-1627431843"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Bits.Utils.html#fromBytes" xdef="imported from Data.Bits.Utils"><span class="hs-identifier hs-var">fromBytes</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.$"><span class="hs-operator hs-var">$</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Real.fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.."><span class="hs-operator hs-var">.</span></a><span> </span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.$"><span class="hs-operator hs-var">$</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-1627431843"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Read one section, returning (ThisSection, Remainder)</span><span>
</span><a name="line-160"></a><span class="hs-identifier">read_section</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Either.Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span> </span><span class="hs-special">(</span><a href="System.FileArchive.GZip.html#Section" xdef=""><span class="hs-identifier hs-type">Section</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><a name="read_section"><a href="System.FileArchive.GZip.html#read_section" xdef=""><span class="hs-identifier">read_section</span></a></a><span> </span><a name="local-1627431844"><a href="#local-1627431844"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a name="local-1627431845"><a href="#local-1627431845"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.FileArchive.GZip.html#read_header" xdef=""><span class="hs-identifier hs-var">read_header</span></a><span> </span><a href="#local-1627431844"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-163"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627431846"><a href="#local-1627431846"><span class="hs-identifier">headerrem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Tuple.snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1627431845"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-164"></a><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431847"><a href="#local-1627431847"><span class="hs-identifier">decompressed</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431848"><a href="#local-1627431848"><span class="hs-identifier">crc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431849"><a href="#local-1627431849"><span class="hs-identifier">remainder</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#read_data" xdef=""><span class="hs-identifier hs-var">read_data</span></a><span> </span><a href="#local-1627431846"><span class="hs-identifier hs-var">headerrem</span></a><span>
</span><a name="line-165"></a><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431850"><a href="#local-1627431850"><span class="hs-identifier">crc32str</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431851"><a href="#local-1627431851"><span class="hs-identifier">rm</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-1627431849"><span class="hs-identifier hs-var">remainder</span></a><span>
</span><a name="line-166"></a><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431852"><a href="#local-1627431852"><span class="hs-identifier">sizestr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431853"><a href="#local-1627431853"><span class="hs-identifier">rem2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-1627431851"><span class="hs-identifier hs-var">rm</span></a><span>
</span><a name="line-167"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627431854"><a href="#local-1627431854"><span class="hs-identifier">filecrc32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#parseword" xdef=""><span class="hs-identifier hs-var">parseword</span></a><span> </span><a href="#local-1627431850"><span class="hs-identifier hs-var">crc32str</span></a><span>
</span><a name="line-168"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627431855"><a href="#local-1627431855"><span class="hs-identifier">filesize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#parseword" xdef=""><span class="hs-identifier hs-var">parseword</span></a><span> </span><a href="#local-1627431852"><span class="hs-identifier hs-var">sizestr</span></a><span>
</span><a name="line-169"></a><span>           </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:Data.Tuple.fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1627431845"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627431847"><span class="hs-identifier hs-var">decompressed</span></a><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>                   </span><a href="System.FileArchive.GZip.html#Footer" xdef=""><span class="hs-identifier hs-var">Footer</span></a><span> </span><span class="hs-special">{</span><a href="System.FileArchive.GZip.html#size" xdef=""><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431855"><span class="hs-identifier hs-var">filesize</span></a><span class="hs-special">,</span><span> </span><a href="System.FileArchive.GZip.html#crc32" xdef=""><span class="hs-identifier hs-var">crc32</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431854"><span class="hs-identifier hs-var">filecrc32</span></a><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>                           </span><a href="System.FileArchive.GZip.html#crc32valid" xdef=""><span class="hs-identifier hs-var">crc32valid</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431854"><span class="hs-identifier hs-var">filecrc32</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes.=="><span class="hs-operator hs-var">==</span></a><span> </span><a href="#local-1627431848"><span class="hs-identifier hs-var">crc</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>                   </span><span class="hs-special">,</span><a href="#local-1627431853"><span class="hs-identifier hs-var">rem2</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Read the file's compressed data, returning</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- (Decompressed, Calculated CRC32, Remainder)</span><span>
</span><a name="line-176"></a><span class="hs-identifier">read_data</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Data.Word" xref="base:GHC.Word.Word32"><span class="hs-identifier hs-type">Word32</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><a name="read_data"><a href="System.FileArchive.GZip.html#read_data" xdef=""><span class="hs-identifier">read_data</span></a></a><span> </span><a name="local-1627431856"><a href="#local-1627431856"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431864"><a href="#local-1627431864"><span class="hs-identifier">decompressed1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431865"><a href="#local-1627431865"><span class="hs-identifier">remainder</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Compression.Inflate.html#inflate_string_remainder" xdef="imported from Data.Compression.Inflate"><span class="hs-identifier hs-var">inflate_string_remainder</span></a><span> </span><a href="#local-1627431856"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-179"></a><span>        </span><span class="hs-special">(</span><a name="local-1627431866"><a href="#local-1627431866"><span class="hs-identifier">decompressed</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431867"><a href="#local-1627431867"><span class="hs-identifier">crc32</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431857"><span class="hs-identifier hs-var">read_data_internal</span></a><span> </span><a href="#local-1627431864"><span class="hs-identifier hs-var">decompressed1</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-180"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-181"></a><span>          </span><span class="hs-special">(</span><a href="#local-1627431866"><span class="hs-identifier hs-var">decompressed</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627431867"><span class="hs-identifier hs-var">crc32</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627431865"><span class="hs-identifier hs-var">remainder</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-183"></a><span>      </span><a name="local-1627431857"><a href="#local-1627431857"><span class="hs-identifier">read_data_internal</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1627431858"><a href="#local-1627431858"><span class="hs-identifier">ck</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-1627431858"><span class="hs-identifier hs-var">ck</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>      </span><span class="hs-identifier">read_data_internal</span><span> </span><span class="hs-special">(</span><a name="local-1627431859"><a href="#local-1627431859"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-1627431860"><a href="#local-1627431860"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627431861"><a href="#local-1627431861"><span class="hs-identifier">ck</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627431862"><a href="#local-1627431862"><span class="hs-identifier">newcrc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Hash.CRC32.GZip.html#update_crc" xdef="imported from Data.Hash.CRC32.GZip"><span class="hs-identifier hs-var">update_crc</span></a><span> </span><a href="#local-1627431861"><span class="hs-identifier hs-var">ck</span></a><span> </span><a href="#local-1627431859"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-186"></a><span>            </span><a name="local-1627431863"><a href="#local-1627431863"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627431862"><span class="hs-identifier hs-var">newcrc</span></a><span> </span><span class="hs-special">`</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Prim.seq"><span class="hs-identifier hs-var">seq</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627431857"><span class="hs-identifier hs-var">read_data_internal</span></a><span> </span><a href="#local-1627431860"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="#local-1627431862"><span class="hs-identifier hs-var">newcrc</span></a><span>
</span><a name="line-187"></a><span>            </span><span class="hs-keyword">in</span><span>
</span><a name="line-188"></a><span>            </span><span class="hs-special">(</span><a href="#local-1627431859"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Tuple.fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1627431863"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Tuple.snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-1627431863"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">{- | Read the GZip header.  Return (Header, Remainder).
-}</span><span>
</span><a name="line-194"></a><span class="hs-identifier">read_header</span><span> </span><span class="hs-glyph">::</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Either.Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="System.FileArchive.GZip.html#GZipError" xdef=""><span class="hs-identifier hs-type">GZipError</span></a><span> </span><span class="hs-special">(</span><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier hs-type">Header</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><a name="read_header"><a href="System.FileArchive.GZip.html#read_header" xdef=""><span class="hs-identifier">read_header</span></a></a><span> </span><a name="local-1627431868"><a href="#local-1627431868"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627431869"><a href="#local-1627431869"><span class="hs-identifier">ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:Data.Either.Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-string">&quot;ok&quot;</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627431870"><a href="#local-1627431870"><span class="hs-identifier">mag</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627431871"><a href="#local-1627431871"><span class="hs-identifier">rem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-1627431868"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-198"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627431870"><span class="hs-identifier hs-var">mag</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><a href="System.FileArchive.GZip.html#magic" xdef=""><span class="hs-identifier hs-var">magic</span></a><span>
</span><a name="line-199"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a xdef="imported from Control.Monad.Error" xref="mtl_KMpng31YRYc5JfMWFZ3FCU:Control.Monad.Error.Class.throwError"><span class="hs-identifier hs-var">throwError</span></a><span> </span><a href="System.FileArchive.GZip.html#NotGZIPFile" xdef=""><span class="hs-identifier hs-var">NotGZIPFile</span></a><span>
</span><a name="line-200"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="#local-1627431869"><span class="hs-identifier hs-var">ok</span></a><span>
</span><a name="line-201"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432021"><a href="#local-1627432021"><span class="hs-identifier">method</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432022"><a href="#local-1627432022"><span class="hs-identifier">rem2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627431871"><span class="hs-identifier hs-var">rem</span></a><span>
</span><a name="line-202"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span class="hs-special">(</span><a href="#local-1627432021"><span class="hs-identifier hs-var">method</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a xdef="imported from Control.Monad.Error" xref="mtl_KMpng31YRYc5JfMWFZ3FCU:Control.Monad.Error.Class.throwError"><span class="hs-identifier hs-var">throwError</span></a><span> </span><a href="System.FileArchive.GZip.html#UnknownMethod" xdef=""><span class="hs-identifier hs-var">UnknownMethod</span></a><span>
</span><a name="line-204"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="#local-1627431869"><span class="hs-identifier hs-var">ok</span></a><span>
</span><a name="line-205"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432023"><a href="#local-1627432023"><span class="hs-identifier">flag_S</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432024"><a href="#local-1627432024"><span class="hs-identifier">rem3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627432022"><span class="hs-identifier hs-var">rem2</span></a><span>
</span><a name="line-206"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432025"><a href="#local-1627432025"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432023"><span class="hs-identifier hs-var">flag_S</span></a><span>
</span><a name="line-207"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432026"><a href="#local-1627432026"><span class="hs-identifier">mtimea</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432027"><a href="#local-1627432027"><span class="hs-identifier">rem3a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-1627432024"><span class="hs-identifier hs-var">rem3</span></a><span>
</span><a name="line-208"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432028"><a href="#local-1627432028"><span class="hs-identifier">mtime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#parseword" xdef=""><span class="hs-identifier hs-var">parseword</span></a><span> </span><a href="#local-1627432026"><span class="hs-identifier hs-var">mtimea</span></a><span>
</span><a name="line-209"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432029"><a href="#local-1627432029"><span class="hs-identifier">xfla</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432030"><a href="#local-1627432030"><span class="hs-identifier">rem3b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627432027"><span class="hs-identifier hs-var">rem3a</span></a><span>
</span><a name="line-210"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432031"><a href="#local-1627432031"><span class="hs-identifier">xfl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432029"><span class="hs-identifier hs-var">xfla</span></a><span>
</span><a name="line-211"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432032"><a href="#local-1627432032"><span class="hs-identifier">osa</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627432030"><span class="hs-identifier hs-var">rem3b</span></a><span>
</span><a name="line-212"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432033"><a href="#local-1627432033"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432032"><span class="hs-identifier hs-var">osa</span></a><span>
</span><a name="line-213"></a><span>       </span><span class="hs-comment">-- skip modtime (4), extraflag (1), and os (1)</span><span>
</span><a name="line-214"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432034"><a href="#local-1627432034"><span class="hs-identifier">rem4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-number">6</span><span> </span><a href="#local-1627432024"><span class="hs-identifier hs-var">rem3</span></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432035"><a href="#local-1627432035"><span class="hs-identifier">extra</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432036"><a href="#local-1627432036"><span class="hs-identifier">rem5</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627432025"><span class="hs-identifier hs-var">flag</span></a><span> </span><a xdef="imported from Data.Bits" xref="base:Data.Bits..&amp;."><span class="hs-operator hs-var">.&amp;.</span></a><span> </span><a href="System.FileArchive.GZip.html#fFEXTRA" xdef=""><span class="hs-identifier hs-var">fFEXTRA</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>               </span><span class="hs-comment">-- Skip past the extra field if we have it.</span><span>
</span><a name="line-219"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432037"><a href="#local-1627432037"><span class="hs-identifier">xlen_S</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627432034"><span class="hs-identifier hs-var">rem4</span></a><span>
</span><a name="line-220"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627432038"><a href="#local-1627432038"><span class="hs-identifier">xlen2_S</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432039"><a href="#local-1627432039"><span class="hs-identifier">rem4b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.FileArchive.GZip.html#split1" xdef=""><span class="hs-identifier hs-var">split1</span></a><span> </span><a href="#local-1627432034"><span class="hs-identifier hs-var">rem4</span></a><span>
</span><a name="line-221"></a><span>                           </span><a name="local-1627432040"><a href="#local-1627432040"><span class="hs-identifier">xlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432037"><span class="hs-identifier hs-var">xlen_S</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Num.+"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">256</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Num.*"><span class="hs-operator hs-var">*</span></a><span> </span><span class="hs-special">(</span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432038"><span class="hs-identifier hs-var">xlen2_S</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627432041"><a href="#local-1627432041"><span class="hs-identifier">ex</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432042"><a href="#local-1627432042"><span class="hs-identifier">rrem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.splitAt"><span class="hs-identifier hs-var">splitAt</span></a><span> </span><a href="#local-1627432040"><span class="hs-identifier hs-var">xlen</span></a><span> </span><a href="#local-1627432039"><span class="hs-identifier hs-var">rem4b</span></a><span>
</span><a name="line-223"></a><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627432041"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627432042"><span class="hs-identifier hs-var">rrem</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627432034"><span class="hs-identifier hs-var">rem4</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432043"><a href="#local-1627432043"><span class="hs-identifier">filename</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432044"><a href="#local-1627432044"><span class="hs-identifier">rem6</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-227"></a><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627432025"><span class="hs-identifier hs-var">flag</span></a><span> </span><a xdef="imported from Data.Bits" xref="base:Data.Bits..&amp;."><span class="hs-operator hs-var">.&amp;.</span></a><span> </span><a href="System.FileArchive.GZip.html#fFNAME" xdef=""><span class="hs-identifier hs-var">fFNAME</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>               </span><span class="hs-comment">-- Skip past the null-terminated filename</span><span>
</span><a name="line-229"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432045"><a href="#local-1627432045"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.takeWhile"><span class="hs-identifier hs-var">takeWhile</span></a><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-char">'\x00'</span><span class="hs-special">)</span><span> </span><a href="#local-1627432036"><span class="hs-identifier hs-var">rem5</span></a><span>
</span><a name="line-230"></a><span>                                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627432045"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:Data.Foldable.length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627432045"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Num.+"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-1627432036"><span class="hs-identifier hs-var">rem5</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627432036"><span class="hs-identifier hs-var">rem5</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627432046"><a href="#local-1627432046"><span class="hs-identifier">comment</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627432047"><a href="#local-1627432047"><span class="hs-identifier">rem7</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-234"></a><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627432025"><span class="hs-identifier hs-var">flag</span></a><span> </span><a xdef="imported from Data.Bits" xref="base:Data.Bits..&amp;."><span class="hs-operator hs-var">.&amp;.</span></a><span> </span><a href="System.FileArchive.GZip.html#fFCOMMENT" xdef=""><span class="hs-identifier hs-var">fFCOMMENT</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                  </span><span class="hs-comment">-- Skip past the null-terminated comment</span><span>
</span><a name="line-236"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627432048"><a href="#local-1627432048"><span class="hs-identifier">cm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.takeWhile"><span class="hs-identifier hs-var">takeWhile</span></a><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-char">'\x00'</span><span class="hs-special">)</span><span> </span><a href="#local-1627432044"><span class="hs-identifier hs-var">rem6</span></a><span>
</span><a name="line-237"></a><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1627432048"><span class="hs-identifier hs-var">cm</span></a><span class="hs-special">,</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:Data.Foldable.length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627432048"><span class="hs-identifier hs-var">cm</span></a><span class="hs-special">)</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Num.+"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-1627432044"><span class="hs-identifier hs-var">rem6</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a xdef="imported from Prelude" xref="base:GHC.Base.Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627432044"><span class="hs-identifier hs-var">rem6</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span>       </span><a name="local-1627432049"><a href="#local-1627432049"><span class="hs-identifier">rem8</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627432025"><span class="hs-identifier hs-var">flag</span></a><span> </span><a xdef="imported from Data.Bits" xref="base:Data.Bits..&amp;."><span class="hs-operator hs-var">.&amp;.</span></a><span> </span><a href="System.FileArchive.GZip.html#fFHCRC" xdef=""><span class="hs-identifier hs-var">fFHCRC</span></a><span> </span><a xdef="imported from Prelude" xref="ghc-prim:GHC.Classes./="><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>                  </span><span class="hs-comment">-- Skip past the header CRC</span><span>
</span><a name="line-242"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.$"><span class="hs-operator hs-var">$</span></a><span> </span><a xdef="imported from Prelude" xref="base:GHC.List.drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-1627432047"><span class="hs-identifier hs-var">rem7</span></a><span>
</span><a name="line-243"></a><span>                  </span><span class="hs-keyword">else</span><span> </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1627432047"><span class="hs-identifier hs-var">rem7</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>       </span><a xdef="imported from Prelude" xref="base:GHC.Base.return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="System.FileArchive.GZip.html#Header" xdef=""><span class="hs-identifier hs-var">Header</span></a><span> </span><span class="hs-special">{</span><a href="System.FileArchive.GZip.html#method" xdef=""><span class="hs-identifier hs-var">method</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a xdef="imported from Data.Char" xref="base:GHC.Base.ord"><span class="hs-identifier hs-var">ord</span></a><span> </span><a href="#local-1627432021"><span class="hs-identifier hs-var">method</span></a><span class="hs-special">,</span><span>
</span><a name="line-246"></a><span>                      </span><a href="System.FileArchive.GZip.html#flags" xdef=""><span class="hs-identifier hs-var">flags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432025"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">,</span><span>
</span><a name="line-247"></a><span>                      </span><a href="System.FileArchive.GZip.html#extra" xdef=""><span class="hs-identifier hs-var">extra</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432035"><span class="hs-identifier hs-var">extra</span></a><span class="hs-special">,</span><span>
</span><a name="line-248"></a><span>                      </span><a href="System.FileArchive.GZip.html#filename" xdef=""><span class="hs-identifier hs-var">filename</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432043"><span class="hs-identifier hs-var">filename</span></a><span class="hs-special">,</span><span>
</span><a name="line-249"></a><span>                      </span><a href="System.FileArchive.GZip.html#comment" xdef=""><span class="hs-identifier hs-var">comment</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432046"><span class="hs-identifier hs-var">comment</span></a><span class="hs-special">,</span><span>
</span><a name="line-250"></a><span>                      </span><a href="System.FileArchive.GZip.html#mtime" xdef=""><span class="hs-identifier hs-var">mtime</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432028"><span class="hs-identifier hs-var">mtime</span></a><span class="hs-special">,</span><span>
</span><a name="line-251"></a><span>                      </span><a href="System.FileArchive.GZip.html#xfl" xdef=""><span class="hs-identifier hs-var">xfl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432031"><span class="hs-identifier hs-var">xfl</span></a><span class="hs-special">,</span><span>
</span><a name="line-252"></a><span>                      </span><a href="System.FileArchive.GZip.html#os" xdef=""><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627432033"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-1627432049"><span class="hs-identifier hs-var">rem8</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- Documentation</span><span>
</span><a name="line-256"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">{- $gzipfiles

GZip files contain one or more 'Section's.  Each 'Section', on disk, begins
with a GZip 'Header', then stores the compressed data itself, and finally
stores a GZip 'Footer'.

The 'Header' identifies the file as a GZip file, records the original
modification date and time, and, in some cases, also records the original
filename and comments.

The 'Footer' contains a GZip CRC32 checksum over the decompressed data as
well as a 32-bit length of the decompressed data.  The module
'Data.Hash.CRC32.GZip' is used to validate stored CRC32 values.

The vast majority of GZip files contain only one 'Section'.  Standard tools
that work with GZip files create single-section files by default.

Multi-section files can be created by simply concatenating two existing
GZip files together.  The standard gunzip and zcat tools will simply
concatenate the decompressed data when reading these files back.  The
'decompress' function in this module will do the same.

When reading data from this module, please use caution regarding how you access
it.  For instance, if you are wanting to write the decompressed stream
to disk and validate its CRC32 value, you could use the 'decompress'
function.  However, you should process the entire stream before you check
the value of the Bool it returns.  Otherwise, you will force Haskell to buffer
the entire file in memory just so it can check the CRC32.
-}</span><span>
</span><a name="line-287"></a></pre></body></html>